<% if @revision.nil? then 
      title=""
   else 
      title = @revision.title
   end 
%>

  <script type='text/javascript'>
    var EMPTYFUNC = function(){};
    var EditorStates = {};
    $("body").ready(function () {
      //addScribble();
      //drawSomething();
      EditorStates.context = myCanvasContext(); 
      EditorStates.options = [
        { name: "new",
          title: "New",
          onclick: function() { 
            window.location.href = "<%= url_for :only_path => false, :action => 'index', :id => 0 %>";
          }
        },
        { name: "color",
          title: "Color",
          onclick: EMPTYFUNC 
        },
        { name: "thickness",
          title: "Line Width",
          onclick: showLineWidthBox
        },
        { name: "scribble",
          title: "Scribble",
          onclick: function() { changeTool("scribble")},
          mousedown: startScribble,
          mousemove: drawScribble,
          mouseup: finishScribble
        },
        { name: "ellipse",
          title: "Ellipse",
          onclick: function() {changeTool("ellipse"); },
          mousedown: EMPTYFUNC,
          mousemove: EMPTYFUNC,
          mouseup: EMPTYFUNC

        },
        { name: "image",
          title: "Image",
          onclick: showImageURLBox 
        },
        { name: "undo",
          title: "Undo",
          onclick: undo
        },
        { name: "clear",
          title: "Clear Canvas",
          onclick: clearCanvas
        }];
        initCanvasEvents();
        // load current image
        <% if @revision %>
        var image = new Image();
        image.onload = function () {
            console.log("image loaded");
            myCanvasContext().drawImage(image, 0, 0);
        };
        image.src = window.location.origin + "<%= @revision.filepath %>";
        <% end %>
        $('.option_color').ColorPicker({
          color: '#0000ff',
          onSubmit: function (hsb, hex, rgb, el) {
            $(el).val(hex);
            myCanvasContext().strokeStyle = hex;
            EditorStates.stroke = hex;
          },
          onBeforeShow: function () { if(this.value != undefined) $(this).ColorPickerSetColor(this.value); }
        });
    });
  </script>

  <%= label_tag "revTitle", "Title: "%> <%= text_field_tag "revTitle", title %>
<div id='optionsPane'>
</div>
<canvas id='myCanvas' width='800' height='600'> </canvas>
<canvas id='backCanvas' width='800' height='600'> </canvas>
<div id='toolbox'>
</div>
<div class='actionPane'>
        <%= link_to_function "Commit", 'commit();' %> <%= link_to "Timeline", :action => 'viewTree' %>
</div>
